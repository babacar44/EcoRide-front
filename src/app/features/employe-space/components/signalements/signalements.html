<div class="signalements container mt-4">
  <h3 class="text-success mb-4">🚩 Signalements de trajets mal passés</h3>

  @if (paginatedSignalements().length === 0) {
    <p class="text-muted">Aucun signalement à traiter.</p>
  }

  <ul class="list-group">
    @for (s of paginatedSignalements(); track s.covoiturageId) {
      <li class="list-group-item shadow-sm mb-3">
        <div class="d-flex justify-content-between align-items-center" (click)="toggleDetails(s.covoiturageId)">
          <span>
            <strong>Covoiturage #TRJ{{s.dateDepart}}{{s.covoiturageId}}</strong> — {{ s.lieuDepart }} → {{ s.lieuArrivee }} ({{ s.dateDepart }})
          </span>
          <i class="bi" [ngClass]="isOpen(s.covoiturageId) ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
        </div>

        @if (isOpen(s.covoiturageId)) {
          <div class="mt-3">
            <div class="mb-2">
              <strong>🚗 Conducteur :</strong><br />
              {{ s.conducteur.prenom }} {{ s.conducteur.nom }} ({{ s.conducteur.pseudo }})<br />
              <i class="text-muted">{{ s.conducteur.email }}</i><br />
              <i class="text-muted">{{ s.conducteur.telephone }}</i><br />
            </div>

            <div class="mb-2">
              <strong>🧍 Passager :</strong><br />
              {{ s.passager.prenom }} {{ s.passager.nom }} ({{ s.passager.pseudo }})<br />
              <i class="text-muted">{{ s.passager.email }}</i><br />
              <i class="text-muted">{{ s.passager.telephone }}</i>
            </div>

            <div class="mb-2">
              <strong>📝 Commentaire :</strong><br />
              <blockquote class="blockquote bg-light p-2 border-start border-danger rounded">
                {{ s.commentaire }}
              </blockquote>
            </div>
            <div class="text-end mt-3">
              <button class="btn btn-success btn-sm" (click)="validerSignalement(s.covoiturageId, s.participationId)">
                ✅ Valider le trajet
              </button>
            </div>
          </div>
        }
      </li>
    }
  </ul>

  @if (totalPages > 1) {
    <nav class="mt-3 text-center">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage() === 1">
          <button class="page-link" (click)="changePage(currentPage() - 1)">Précédent</button>
        </li>
        @for (page of [].constructor(totalPages); track $index; let i = $index) {
          <li class="page-item" [class.active]="currentPage() === i + 1">
            <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
          </li>
        }
        <li class="page-item" [class.disabled]="currentPage() === totalPages">
          <button class="page-link" (click)="changePage(currentPage() + 1)">Suivant</button>
        </li>
      </ul>
    </nav>
  }
</div>
